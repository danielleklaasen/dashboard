function fnShowNotification(e,n){oSound.play();var i=document.title,t="New "+n+" received";oChangeTitle=setInterval(function(){fnChangeTitle(i,t)},1e3),fnShowDesktopNotification(e)}function fnChangeTitle(e,n){iIterations<6?document.title===e?document.title=n:document.title=e:(clearInterval(oChangeTitle),iIterations=0),iIterations++}function fnShowDesktopNotification(e){"granted"!==Notification.permission?Notification.requestPermission():new Notification(e).onclick=function(){fnOpenReportWdw()}}function fnResetTimer(){clearTimeout(oMessageTimer)}function fnShowMessage(e,n){var i=$("#message");switch(i.text(e),n){case"success":i.removeClass("error").addClass("success");break;case"error":i.className="",i.removeClass("success").addClass("error");break;default:i.className=""}i.animate({top:0},550),bTimerIsSet&&fnResetTimer(),oMessageTimer=setTimeout(function(){fnHideMessage()},2e3),bTimerIsSet=!0}function fnHideMessage(){bTimerIsSet=!1;$("#message").animate({top:"-50px"},550)}document.addEventListener("DOMContentLoaded",function(){Notification?"granted"!==Notification.permission&&Notification.requestPermission():console.log("Desktop notifications aren't available in your browser.")});var oSound=new Audio("audio/notification.mp3"),oChangeTitle,iIterations=0,bTimerIsSet=!1,oMessageTimer,fnOpenWdw=function(e){var n=$("."+e);n.addClass("open"),n.fadeIn()},fnCloseAllWdws=function(){var e=$(".wdw.open");e.fadeOut(),e.removeClass("open")},fnSetActiveMenuItem=function(e){$(".menu-item").removeClass("active"),$("."+e).addClass("active")},fnOpenReportWdw=function(){fnCloseAllWdws(),fnOpenWdw("report-wdw"),fnSetActiveMenuItem("open-report-wdw")},fnOpenArchiveWdw=function(){fnCloseAllWdws(),fnOpenWdw("archive-wdw"),fnSetActiveMenuItem("open-archive-wdw")},fnOpenHomeWdw=function(){fnCloseAllWdws(),fnOpenWdw("home-wdw"),fnSetActiveMenuItem("open-home")},fnOpenProfileWdw=function(){fnCloseAllWdws(),fnOpenWdw("profile-wdw")};$(document).on("click",".open-report-wdw",function(){fnOpenReportWdw()}),$(document).on("click",".open-archive-wdw",function(){fnOpenArchiveWdw()}),$(document).on("click",".open-home",function(){fnOpenHomeWdw()}),$(document).on("click",".open-profile",function(){fnOpenProfileWdw()});var sSidebar=$("#sidebar"),fnOpenSidebar=function(){sSidebar.hasClass("open")||sSidebar.addClass("open")},fnCloseSidebar=function(){sSidebar.hasClass("open")&&sSidebar.removeClass("open")};$(document).on("click",".open-menu",function(){fnOpenSidebar()}),$(document).on("mouseenter","#sidebar",function(){fnOpenSidebar()}),$(document).on("mouseleave","#sidebar",function(){fnCloseSidebar()}),$(document).on("click touchend",".close-menu, .sidebar-close, .menu-item-mobile, .menu-item",function(){fnCloseSidebar()});var fnLogin=function(){$(".login-wdw").fadeOut(),fnOpenHomeWdw()};$(document).on("click",".btn-login",function(e){e.preventDefault(),fnLogin()}),$(document).on("click",".close-search",function(){fnCloseSearch()}),$(document).on("click",".open-search",function(){fnOpenSearch()});var fnCloseSearch=function(){$(".search-wdw").fadeOut()},fnOpenSearch=function(){$(".search-wdw").css("display","flex").hide().fadeIn(),$("#search-input").focus()},oDatabase=firebase.database(),iPendingReports=0,sPendingNotification=$("#pending-notification");sPendingNotification.hide();var bFirstLoaded=!1,bNewPendingReports=!1,aLoadedReports=[],oBikesRef=oDatabase.ref("bikes");oBikesRef.orderByChild("timeStamp").on("value",function(e){sPendingReports=$(".pending-reports-num"),sPendingReports.text(iPendingReports),e.forEach(function(e){var n=e.val(),i=n.bikeID,t=n.timeStamp;if(console.log("timestamp: "+t),-1!=$.inArray(i,aLoadedReports));else{var o=n.companyName,r=n.damages;switch(n.status){case"pending":fnAddPending(i,o,r),iPendingReports++,sPendingReports.text(iPendingReports),sPendingNotification.show(),bNewPendingReports=!0;break;case"accepted":fnAddAccepted(i,o,r);break;case"declined":fnAddDeclined(i,o,r)}aLoadedReports.push(i)}}),bFirstLoaded&&bNewPendingReports&&fnShowNotification("New pending reports","report"),bNewPendingReports=!1,bFirstLoaded=!0});var fnFormatDamage=function(e){var n="";if(e)for(var i=0;i<e.length;i++)i<3&&(n+=e[i]+"<br>"),4===i&&(n+='<button class="more-btn"><div class="circles-container"><div class="circle"></div><div class="circle"></div><div class="circle"></div></div></button>');return n},fnAddPending=function(e,n,i){var t=' <div id="'+e+'" class="text-report-card card card-1"><div class="h4 card-text"><p class="bold">Damaged part(s)</p>'+fnFormatDamage(i)+'<br/><br/><p class="bold">'+n+"</p>Bike id "+e+'</div><div class="card-buttons"><svg class="lnr lnr-checkmark-circle report-accept link"><use xlink:href="#lnr-checkmark-circle"></use></svg><svg class="lnr lnr-cross-circle report-decline link"><use xlink:href="#lnr-cross-circle"></use></svg><svg class="report-delete lnr lnr-trash link"><use xlink:href="#lnr-trash"></use></svg></div></div>';$("#report-container").append(t)},fnAddAccepted=function(e,n,i){var t=' <div id="'+e+'" class="text-report-card card card-1 card-accept"><div class="h4 card-text"><p class="bold">Damaged part(s)</p>'+fnFormatDamage(i)+'<br/><br/><p class="bold">'+n+"</p>Bike id "+e+'</div><div class="card-buttons"><svg class="lnr lnr-checkmark-circle report-accept link"><use xlink:href="#lnr-checkmark-circle"></use></svg><svg class="lnr lnr-cross-circle report-decline link"><use xlink:href="#lnr-cross-circle"></use></svg><svg class="report-delete lnr lnr-trash link"><use xlink:href="#lnr-trash"></use></svg></div></div>';$("#archive-container").append(t)},fnAddDeclined=function(e,n,i){var t=' <div id="'+e+'" class="text-report-card card card-1 card-decline"><div class="h4 card-text"><p class="bold">Damaged part(s)</p>'+fnFormatDamage(i)+'<br/><br/><p class="bold">'+n+"</p>Bike id "+e+'</div><div class="card-buttons"><svg class="lnr lnr-checkmark-circle report-accept link"><use xlink:href="#lnr-checkmark-circle"></use></svg><svg class="lnr lnr-cross-circle report-decline link"><use xlink:href="#lnr-cross-circle"></use></svg><svg class="report-delete lnr lnr-trash link"><use xlink:href="#lnr-trash"></use></svg></div></div>';$("#archive-container").append(t)},fnSetStatus=function(e,n){oDatabase.ref("bikes/"+e+"/status").set(n)},fnArchiveCard=function(e,n){var i=$("#"+e);i.appendTo("#archive-container"),i.addClass("card-"+n)},fnRemovePendingNotification=function(){0===--iPendingReports&&sPendingNotification.hide(),$(".pending-reports-num").text(iPendingReports)};$(document).on("click",".report-accept",function(){fnAcceptReport(this)});var fnAcceptReport=function(e){var n=e.parentNode.parentNode.id;fnSetStatus(n,"accepted"),fnRemovePendingNotification(),fnArchiveCard(n,"accept"),fnShowMessage("Report accepted","success")};$(document).on("click",".report-decline",function(){fnDeclineReport(this)});var fnDeclineReport=function(e){var n=e.parentNode.parentNode.id;fnSetStatus(n,"declined"),fnRemovePendingNotification(),fnArchiveCard(n,"decline"),fnShowMessage("Report declined","error")},fnDeleteReport=function(e){var n=e.parentNode.parentNode.id;oDatabase.ref("bikes/"+n).remove(function(e){e?fnShowMessage("Delete failed...","error"):($("#"+n).remove(),aLoadedReports.splice(n,1),fnShowMessage("Report deleted!","success"))})};$(document).on("click",".report-delete",function(){fnDeleteReport(this)});